{"ast":null,"code":"var _jsxFileName = \"/Users/dahan/Desktop/blockchain/BTA1stProject-18/near-pocket/src/views/Popup/ImportAccount.js\",\n  _s = $RefreshSig$();\nimport React, { useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useDispatch } from \"react-redux\";\nimport { encryptMessage, getAccountIds, getStorageSyncValue, setStorageSyncValue } from \"../../utils/utilsUpdated\";\nimport { parseSeedPhrase } from \"near-seed-phrase\";\nimport { KeyPair, connect, WalletConnection } from \"near-api-js\";\nimport { SWITCH_ACCOUNT } from \"../../redux/actionTypes\";\nimport { CONFIG } from \"../../constants\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst ImportAccount = () => {\n  _s();\n  const [loading, setLoading] = useState(false);\n  const [phrase, setPhrase] = useState(\"\");\n  const dispatch = useDispatch();\n  const navigate = useNavigate();\n  const importAccount = async () => {\n    try {\n      const split = phrase.split(\" \");\n      if (split.length === 1) {\n        throw new Error(\"유효하지 않은 시드 구문입니다.\");\n      }\n      if (!phrase) return;\n      const {\n        secretKey,\n        seedPhrase\n      } = parseSeedPhrase(phrase);\n      //console.log(secretKey);\n      const keyPair = KeyPair.fromString(secretKey);\n      const publicKey = keyPair.publicKey.toString(); //키페어에 퍼블릭키를 가져온다.\n      console.log(publicKey);\n      const near = await connect(CONFIG);\n      const wallet = new WalletConnection(near);\n      const testID = wallet.getAccountId();\n      const accountIdsByPublickKey = await getAccountIds(publicKey); //퍼블릭키로 Account ID를 가져온다.\n      console.log(\"ID -- \" + testID);\n      if (!phrase || accountIdsByPublickKey.length === 0) {\n        throw new Error(\"유효하지 않은 시드 구문입니다.\");\n      }\n      setLoading(true);\n      let isExist = false;\n      let userInfo = await getStorageSyncValue(\"userInfo\");\n      console.log(userInfo);\n      for (let info in userInfo) {\n        if (userInfo[info].accountID === accountIdsByPublickKey) {\n          isExist = true;\n        }\n      }\n      if (isExist) {\n        alert(\"해당 계정은 이미 존재합니다.\");\n        setLoading(false);\n        return;\n      }\n      let hashedPassword = await getStorageSyncValue(\"hashedPassword\");\n      const cipherPrivateKey = encryptMessage(secretKey, hashedPassword);\n      const cipherPhrase = encryptMessage(seedPhrase, hashedPassword);\n      let keys = userInfo ? Object.keys(userInfo) : null;\n      let walletName = `wallet${keys.length + 1}`;\n      userInfo = {\n        ...userInfo,\n        [walletName]: {\n          name: walletName,\n          accountID: accountIdsByPublickKey,\n          accounts: {\n            [publicKey]: {\n              data: cipherPhrase,\n              address: publicKey,\n              secretKey: cipherPrivateKey\n            }\n          }\n        }\n      };\n      dispatch({\n        type: SWITCH_ACCOUNT,\n        payload: {\n          activeWallet: keys ? `wallet${keys.length + 1}` : \"wallet1\",\n          activeAccountID: accountIdsByPublickKey\n        }\n      });\n      await setStorageSyncValue(\"userInfo\", userInfo);\n      setLoading(false);\n      navigate(\"/dashboard\");\n    } catch (error) {\n      console.log(\"error : \", error.message);\n      setLoading(false);\n      alert(error.message);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      children: \"\\uC2DC\\uB4DC \\uAD6C\\uBB38\\uC73C\\uB85C \\uACC4\\uC815 \\uAC00\\uC838\\uC624\\uAE30\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n      value: phrase,\n      onChange: e => setPhrase(e.target.value)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 7\n    }, this), loading ? /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Loading...\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 105,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: importAccount,\n      children: \"\\uAC00\\uC838\\uC624\\uAE30\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      style: {\n        marginTop: 10\n      },\n      onClick: () => navigate(\"/dashboard\"),\n      children: [\" \", \"<\", \" \\uB4A4\\uB85C\\uAC00\\uAE30\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 109,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 101,\n    columnNumber: 5\n  }, this);\n};\n_s(ImportAccount, \"aEMqR7YdE0TXRQMqfsutzQH0cDA=\", false, function () {\n  return [useDispatch, useNavigate];\n});\n_c = ImportAccount;\nexport default ImportAccount;\nvar _c;\n$RefreshReg$(_c, \"ImportAccount\");","map":{"version":3,"names":["React","useState","useNavigate","useDispatch","encryptMessage","getAccountIds","getStorageSyncValue","setStorageSyncValue","parseSeedPhrase","KeyPair","connect","WalletConnection","SWITCH_ACCOUNT","CONFIG","ImportAccount","loading","setLoading","phrase","setPhrase","dispatch","navigate","importAccount","split","length","Error","secretKey","seedPhrase","keyPair","fromString","publicKey","toString","console","log","near","wallet","testID","getAccountId","accountIdsByPublickKey","isExist","userInfo","info","accountID","alert","hashedPassword","cipherPrivateKey","cipherPhrase","keys","Object","walletName","name","accounts","data","address","type","payload","activeWallet","activeAccountID","error","message","e","target","value","marginTop"],"sources":["/Users/dahan/Desktop/blockchain/BTA1stProject-18/near-pocket/src/views/Popup/ImportAccount.js"],"sourcesContent":["import React, { useState } from \"react\";\nimport { useNavigate } from \"react-router-dom\";\nimport { useDispatch } from \"react-redux\";\n\nimport {\n  encryptMessage,\n  getAccountIds,\n  getStorageSyncValue,\n  setStorageSyncValue,\n} from \"../../utils/utilsUpdated\";\nimport { parseSeedPhrase } from \"near-seed-phrase\";\nimport { KeyPair, connect, WalletConnection } from \"near-api-js\";\nimport { SWITCH_ACCOUNT } from \"../../redux/actionTypes\";\nimport { CONFIG } from \"../../constants\";\n\nconst ImportAccount = () => {\n  const [loading, setLoading] = useState(false);\n  const [phrase, setPhrase] = useState(\"\");\n  const dispatch = useDispatch();\n\n  const navigate = useNavigate();\n\n  const importAccount = async () => {\n    try {\n      const split = phrase.split(\" \");\n      if (split.length === 1) {\n        throw new Error(\"유효하지 않은 시드 구문입니다.\");\n      }\n      if (!phrase) return;\n      const { secretKey, seedPhrase } = parseSeedPhrase(phrase);\n      //console.log(secretKey);\n      const keyPair = KeyPair.fromString(secretKey);\n      const publicKey = keyPair.publicKey.toString(); //키페어에 퍼블릭키를 가져온다.\n      console.log(publicKey);\n\n      const near = await connect(CONFIG);\n      const wallet = new WalletConnection(near);\n      const testID = wallet.getAccountId();\n\n      const accountIdsByPublickKey = await getAccountIds(publicKey); //퍼블릭키로 Account ID를 가져온다.\n      console.log(\"ID -- \" + testID);\n\n      if (!phrase || accountIdsByPublickKey.length === 0) {\n        throw new Error(\"유효하지 않은 시드 구문입니다.\");\n      }\n      setLoading(true);\n\n      let isExist = false;\n      let userInfo = await getStorageSyncValue(\"userInfo\");\n      console.log(userInfo);\n      for (let info in userInfo) {\n        if (userInfo[info].accountID === accountIdsByPublickKey) {\n          isExist = true;\n        }\n      }\n\n      if (isExist) {\n        alert(\"해당 계정은 이미 존재합니다.\");\n        setLoading(false);\n        return;\n      }\n      let hashedPassword = await getStorageSyncValue(\"hashedPassword\");\n      const cipherPrivateKey = encryptMessage(secretKey, hashedPassword);\n      const cipherPhrase = encryptMessage(seedPhrase, hashedPassword);\n      let keys = userInfo ? Object.keys(userInfo) : null;\n      let walletName = `wallet${keys.length + 1}`;\n      userInfo = {\n        ...userInfo,\n        [walletName]: {\n          name: walletName,\n          accountID: accountIdsByPublickKey,\n          accounts: {\n            [publicKey]: {\n              data: cipherPhrase,\n              address: publicKey,\n              secretKey: cipherPrivateKey,\n            },\n          },\n        },\n      };\n\n      dispatch({\n        type: SWITCH_ACCOUNT,\n        payload: {\n          activeWallet: keys ? `wallet${keys.length + 1}` : \"wallet1\",\n          activeAccountID: accountIdsByPublickKey,\n        },\n      });\n\n      await setStorageSyncValue(\"userInfo\", userInfo);\n      setLoading(false);\n      navigate(\"/dashboard\");\n    } catch (error) {\n      console.log(\"error : \", error.message);\n      setLoading(false);\n      alert(error.message);\n    }\n  };\n\n  return (\n    <div>\n      <h3>시드 구문으로 계정 가져오기</h3>\n      <input value={phrase} onChange={e => setPhrase(e.target.value)} />\n      {loading ? (\n        <p>Loading...</p>\n      ) : (\n        <button onClick={importAccount}>가져오기</button>\n      )}\n      <button style={{ marginTop: 10 }} onClick={() => navigate(\"/dashboard\")}>\n        {\" \"}\n        {\"<\"} 뒤로가기\n      </button>\n    </div>\n  );\n};\n\nexport default ImportAccount;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}